Non-\/blocking high-\/level wrapper for libcurl.

\subsection*{Example}


\begin{DoxyCode}
\textcolor{preprocessor}{#include <stdio.h>}
\textcolor{preprocessor}{#include <string.h>}
\textcolor{preprocessor}{#include <unistd.h>}
\textcolor{preprocessor}{#include <signal.h>}
\textcolor{preprocessor}{#include <signal.h>}
\textcolor{preprocessor}{#include <librd/rdthread.h>}
\textcolor{preprocessor}{#include <librbhttp/librb-http.h>}

\textcolor{keyword}{static} \textcolor{keywordtype}{int} running = 1;
\textcolor{keyword}{struct }\hyperlink{structrb__http__handler__s}{rb\_http\_handler\_s} *handler = NULL;

\textcolor{keyword}{static} \textcolor{keywordtype}{void} my\_callback (\textcolor{keyword}{struct} \hyperlink{structrb__http__handler__s}{rb\_http\_handler\_s} *rb\_http\_handler,
                         \textcolor{keywordtype}{int} status\_code,
                         \textcolor{keywordtype}{long} http\_status,
                         \textcolor{keyword}{const} \textcolor{keywordtype}{char} *status\_code\_str,
                         \textcolor{keywordtype}{char} *buff,
                         \textcolor{keywordtype}{size\_t} bufsiz,
                         \textcolor{keywordtype}{void} *opaque) \{

    \textcolor{keywordflow}{if} (status\_code != 0) \{
        printf (\textcolor{stringliteral}{"CURL CODE: %d\(\backslash\)n"}, status\_code);
    \}

    \textcolor{keywordflow}{if} (status\_code == 0) \{
        printf (\textcolor{stringliteral}{"HTTP STATUS: %ld\(\backslash\)n"}, http\_status);
    \}

    \textcolor{keywordflow}{if} (buff != NULL)
        printf (\textcolor{stringliteral}{"MESSAGE: %s\(\backslash\)n"}, buff);

    \textcolor{keywordflow}{if} (opaque != NULL)
        printf (\textcolor{stringliteral}{"OPAQUE: %p\(\backslash\)n"}, opaque);

    (void) rb\_http\_handler;
    (void) bufsiz;
    (void) status\_code\_str;
\}

\textcolor{keywordtype}{int} \hyperlink{rb__http__handler__example_8c_ae66f6b31b5ad750f1fe042a706a4e3d4}{main}() \{
    \textcolor{keywordtype}{char} url[] = \textcolor{stringliteral}{"http://localhost:8080/librb-http/"};
    \textcolor{keywordtype}{char} \textcolor{keywordtype}{string}[128];

    handler = \hyperlink{librb-http_8h_aa84a3dadccb44fa421655ad1b09c3157}{rb\_http\_handler\_create} (url, NULL, 0);
    \hyperlink{librb-http_8h_ab306abb2b4a66b092205de2677d342aa}{rb\_http\_handler\_set\_opt}(handler, \textcolor{stringliteral}{"HTTP\_MAX\_TOTAL\_CONNECTIONS"}, \textcolor{stringliteral}{"4"}, NULL, 0);
    \hyperlink{librb-http_8h_ab306abb2b4a66b092205de2677d342aa}{rb\_http\_handler\_set\_opt}(handler, \textcolor{stringliteral}{"HTTP\_TIMEOUT"}, \textcolor{stringliteral}{"10000"}, NULL, 0);
    \hyperlink{librb-http_8h_ab306abb2b4a66b092205de2677d342aa}{rb\_http\_handler\_set\_opt}(handler, \textcolor{stringliteral}{"HTTP\_CONNTTIMEOUT"}, \textcolor{stringliteral}{"3000"}, NULL, 0);
    \hyperlink{librb-http_8h_ab306abb2b4a66b092205de2677d342aa}{rb\_http\_handler\_set\_opt}(handler, \textcolor{stringliteral}{"HTTP\_VERBOSE"}, \textcolor{stringliteral}{"0"}, NULL, 0);
    \hyperlink{librb-http_8h_ab306abb2b4a66b092205de2677d342aa}{rb\_http\_handler\_set\_opt}(handler, \textcolor{stringliteral}{"RB\_HTTP\_MAX\_MESSAGES"}, \textcolor{stringliteral}{"512"}, NULL, 0);

    printf (\textcolor{stringliteral}{"Sending 1024 messages\(\backslash\)n"});
    \textcolor{keywordtype}{int} i = 0;

    \textcolor{comment}{// getchar();}
    \textcolor{keywordtype}{char} *message = NULL;

    \textcolor{keywordflow}{for} (i = 0 ; i < 1024 && running; i++) \{
        sprintf (\textcolor{keywordtype}{string}, \textcolor{stringliteral}{"\{\(\backslash\)"message\(\backslash\)": \(\backslash\)"%d\(\backslash\)"\}"}, i);
        \textcolor{keywordflow}{while} (\hyperlink{librb-http_8h_a0d0d31d9c2dc9ed04d6722e5653b4682}{rb\_http\_produce} (handler,
                                message = strdup (\textcolor{keywordtype}{string}),
                                strlen (\textcolor{keywordtype}{string}),
                                \hyperlink{librb-http_8h_aef79f44f520e54cbedce1068fe324720}{RB\_HTTP\_MESSAGE\_F\_FREE},
                                NULL,
                                0,
                                NULL) > 0 && running) \{
            \hyperlink{librb-http_8h_a890e981b619b1bdd5cc37fa16bb06f06}{rb\_http\_get\_reports} (handler, my\_callback, 1000);
            free(message);
        \}
    \}

    \textcolor{keywordflow}{while} (\hyperlink{librb-http_8h_a890e981b619b1bdd5cc37fa16bb06f06}{rb\_http\_get\_reports} (handler, my\_callback, 100) && running);

    \hyperlink{librb-http_8h_aea4aa423ff2034b027817632c746fd39}{rb\_http\_handler\_destroy} (handler, NULL, 0);

    \textcolor{keywordflow}{return} 0;
\}
\}
\end{DoxyCode}
 